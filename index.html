<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geo-Red de Usuarios</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header class="main-header">
        <div class="header-brand">
            <span class="logo-text">GeoRed</span>
        </div>
        <nav class="main-nav">
            <button id="btn-search-service" class="nav-btn nav-btn-search">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18.031 16.617l4.283 4.282-1.415 1.415-4.282-4.283A8.96 8.96 0 0 1 11 20c-4.968 0-9-4.032-9-9s4.032-9 9-9 9 4.032 9 9a8.96 8.96 0 0 1-1.969 5.617zm-2.006-.742A6.977 6.977 0 0 0 18 11c0-3.868-3.133-7-7-7-3.868 0-7 3.132-7 7 0 3.867 3.132 7 7 7a6.977 6.977 0 0 0 4.875-1.975l.15-.15z"></path></svg>
                <span>Buscar</span>
            </button>
            <button id="btn-add-service" class="nav-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2h6z"></path></svg>
                <span>Publicar</span>
            </button>
            <button id="btn-profile-menu" class="nav-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2c5.52 0 10 4.48 10 10s-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2zm0 4c-1.93 0-3.5 1.57-3.5 3.5S10.07 13 12 13s3.5-1.57 3.5-3.5S13.93 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88a9.947 9.947 0 0 1 12.28 0C16.43 19.18 14.03 20 12 20z"></path></svg>
                <span>Iniciar Sesi√≥n</span>
            </button>
        </nav>
    </header>

    <main>
        <!-- Secci√≥n del Mapa (vista principal) -->
        <section id="map-section" class="active-section">
            <div id="map"></div>

            <!-- Hero overlay (mini-landing sobre el mapa) -->
            <div class="map-hero" role="region" aria-label="Introducci√≥n">
                <h1 class="hero-title">Encuentra servicios locales</h1>
                <p class="hero-subtitle">Publica tu oferta en 1 minuto</p>
                <div class="hero-ctas">
                    <button id="hero-explore" class="cta-btn">Explorar mapa</button>
                    <button id="hero-publish" class="cta-btn secondary">Publicar servicio</button>
                </div>
            </div>

            <div class="floating-controls">
                <button id="btn-current-location" class="control-btn" title="Mostrar tu ubicacion">
                    <span>üìç</span>
                </button>
            </div>
        </section>

        <!-- Panel de B√∫squeda de Servicios -->
        <aside id="search-panel" class="search-panel">
            <div class="panel-content">
                <div class="panel-header">
                    <h2>Buscar servicios cerca de m√≠</h2>
                    <button id="close-search-panel" class="close-btn">&times;</button>
                </div>
                <div class="search-container">
                    <input type="text" id="service-search-input" placeholder="Buscar servicios..." class="search-input">
                    <div id="filter-status" class="filter-status"></div>
                    <div id="service-categories" class="categories-grid"></div>
                </div>
                <div id="search-results" class="results-container">
                    <div id="results-count"></div>
                    <ul id="nearby-users-list"></ul>
                </div>
            </div>
        </aside>

        <!-- Panel de Publicar Servicio -->
        <aside id="publish-panel" class="search-panel">
            <div class="panel-content">
                <div class="panel-header">
                    <h2>Publicar un servicio</h2>
                    <button id="close-publish-panel" class="close-btn">&times;</button>
                </div>
                <form id="register-form" class="publish-form">
                    <div class="form-group">
                        <label for="service-name">Nombre del servicio:</label>
                        <input type="text" id="service-name" required placeholder="Ej: Reparaci√≥n de electrodom√©sticos">
                    </div>
                    <div class="form-group">
                        <label for="service-description">Descripci√≥n del servicio:</label>
                        <textarea id="service-description" required placeholder="Describe tu servicio en detalle..." rows="3"></textarea>
                    </div>
                    
                    <!-- Sistema de Precios Mejorado -->
                    <div class="form-group">
                        <label for="service-price">Precio:</label>
                        <div class="price-input-group">
                            <span class="currency-symbol">$</span>
                            <input type="number" id="service-price" required placeholder="15000" min="0" step="100">
                        </div>
                        <small class="form-hint">Ingresa solo el monto num√©rico (sin puntos ni comas)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="price-modality">Modalidad de cobro:</label>
                        <select id="price-modality" required>
                            <option value="por_servicio" selected>Por servicio completo</option>
                            <option value="por_hora">Por hora</option>
                            <option value="por_dia">Por d√≠a</option>
                            <option value="por_mes">Por mes</option>
                            <option value="por_proyecto">Por proyecto</option>
                            <option value="consultar">A consultar</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="service-schedule">Horario de atenci√≥n:</label>
                        <select id="service-schedule" required>
                            <option value="">Selecciona un horario</option>
                            <option value="Lunes a Viernes">Lunes a Viernes</option>
                            <option value="Lunes a S√°bado">Lunes a S√°bado</option>
                            <option value="Lunes a Domingo">Lunes a Domingo</option>
                            <option value="24 horas">24 horas</option>
                            <option value="Solo festivos">Solo festivos</option>
                        </select>
                    </div>
                    
                    <!-- Secci√≥n de Contacto Mejorada -->
                    <div class="form-group">
                        <label>M√©todo de contacto preferido:</label>
                        <div class="contact-method-selector">
                            <label class="radio-button-option" for="contact-email">
                                <input type="radio" id="contact-email" name="contact-method" value="email" checked>
                                <span class="radio-button-content">üìß Email</span>
                            </label>
                            <label class="radio-button-option" for="contact-phone">
                                <input type="radio" id="contact-phone" name="contact-method" value="phone">
                                <span class="radio-button-content">üì± Tel√©fono m√≥vil</span>
                            </label>
                        </div>
                    </div>

                    <!-- Email Contact Section -->
                    <div id="email-contact-section" class="contact-section">
                        <div class="form-group">
                            <label for="user-email">Email de contacto:</label>
                            <input type="email" id="user-email" value="contacto@ejemplo.com" placeholder="tu-email@ejemplo.com">
                            <small class="form-hint">Este email ser√° visible solo para clientes interesados</small>
                        </div>
                    </div>

                    <!-- Phone Contact Section -->
                    <div id="phone-contact-section" class="contact-section hidden">
                        <div class="form-group">
                            <label for="user-phone">Tel√©fono m√≥vil:</label>
                            <input type="tel" id="user-phone" value="+56912345678" placeholder="+56912345678" maxlength="20">
                            <small class="form-hint">Incluye c√≥digo de pa√≠s. Ej: +56912345678, +34612345678</small>
                            <div id="phone-validation" class="validation-message"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-option" for="whatsapp-available">
                                <input type="checkbox" id="whatsapp-available" checked>
                                <span class="checkbox-content">üì± Tambi√©n disponible en WhatsApp</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Ubicaci√≥n del servicio:</label>
                        <button type="button" id="change-location-btn" class="change-location-btn">üìç Cambiar ubicaci√≥n</button>
                    </div>
                    <div class="form-group">
                        <label for="service-address">Direcci√≥n del servicio:</label>
                        <input type="text" id="service-address" required placeholder="Ingresa la direcci√≥n...">
                    </div>
                    <div class="form-group">
                        <label for="service-main-category">Categor√≠a principal:</label>
                        <select id="service-main-category" required>
                            <option value="">Selecciona una categor√≠a</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="service-subcategory">Servicio espec√≠fico:</label>
                        <select id="service-subcategory" required>
                            <option value="">Selecciona un servicio</option>
                        </select>
                    </div>
                    <button type="submit" class="submit-btn">Publicar Servicio</button>
                </form>
            </div>
        </aside>

        <!-- Panel de Detalles de Servicio -->
        <aside id="detail-panel" class="detail-panel">
            <div class="panel-content">
                <div class="panel-header">
                    <h2>Detalles del Servicio</h2>
                    <button id="close-detail-panel" class="close-btn">&times;</button>
                </div>
                <div id="service-detail-content" class="service-detail-content">
                    <!-- Contenido din√°mico del servicio -->
                </div>
            </div>
        </aside>

        <!-- Modal de Autenticaci√≥n -->
        <section id="profile-modal" class="modal hidden-section">
            <div class="modal-content auth-modal">
                <button id="close-profile-modal" class="close-btn">&times;</button>
                
                <!-- Usuario NO autenticado: Login/Registro -->
                <div id="auth-section" class="auth-section">
                    <!-- Tabs de navegaci√≥n -->
                    <div class="auth-tabs">
                        <button class="auth-tab active" data-tab="login">Iniciar Sesi√≥n</button>
                        <button class="auth-tab" data-tab="register">Crear Cuenta</button>
                    </div>

                    <!-- Formulario de Login -->
                    <div id="login-tab-content" class="auth-tab-content active">
                        <h2 class="auth-title">Bienvenido de vuelta</h2>
                        <p class="auth-subtitle">Ingresa a tu cuenta para publicar y gestionar tus servicios</p>
                        
                        <form id="login-form" class="auth-form">
                            <div class="form-group">
                                <label for="login-email">Correo electr√≥nico</label>
                                <input 
                                    type="email" 
                                    id="login-email" 
                                    required 
                                    placeholder="tu@email.com"
                                    autocomplete="email">
                            </div>
                            
                            <div class="form-group">
                                <label for="login-password">Contrase√±a</label>
                                <input 
                                    type="password" 
                                    id="login-password" 
                                    required 
                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                    autocomplete="current-password"
                                    minlength="6">
                            </div>
                            
                            <div id="login-error" class="error-message hidden"></div>
                            
                            <button type="submit" class="submit-btn auth-submit-btn">
                                Iniciar Sesi√≥n
                            </button>
                        </form>
                    </div>

                    <!-- Formulario de Registro -->
                    <div id="register-tab-content" class="auth-tab-content">
                        <h2 class="auth-title">Crea tu cuenta</h2>
                        <p class="auth-subtitle">√önete y comienza a publicar tus servicios</p>
                        
                        <form id="signup-form" class="auth-form">
                            <div class="form-group">
                                <label for="register-name">Nombre completo</label>
                                <input 
                                    type="text" 
                                    id="register-name" 
                                    required 
                                    placeholder="Juan P√©rez"
                                    autocomplete="name">
                            </div>
                            
                            <div class="form-group">
                                <label for="register-email">Correo electr√≥nico</label>
                                <input 
                                    type="email" 
                                    id="register-email" 
                                    required 
                                    placeholder="tu@email.com"
                                    autocomplete="email">
                            </div>
                            
                            <div class="form-group">
                                <label for="register-phone">Tel√©fono (opcional)</label>
                                <input 
                                    type="tel" 
                                    id="register-phone" 
                                    placeholder="+56912345678"
                                    autocomplete="tel">
                                <small class="form-hint">Incluye c√≥digo de pa√≠s. Ej: +56912345678</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="register-password">Contrase√±a</label>
                                <input 
                                    type="password" 
                                    id="register-password" 
                                    required 
                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                    autocomplete="new-password"
                                    minlength="6">
                                <small class="form-hint">M√≠nimo 6 caracteres</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="register-password-confirm">Confirmar contrase√±a</label>
                                <input 
                                    type="password" 
                                    id="register-password-confirm" 
                                    required 
                                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                    autocomplete="new-password"
                                    minlength="6">
                            </div>
                            
                            <div id="register-error" class="error-message hidden"></div>
                            
                            <button type="submit" class="submit-btn auth-submit-btn">
                                Crear Cuenta
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Usuario autenticado: Men√∫ de perfil -->
                <div id="user-menu-section" class="user-menu-section hidden">
                    <div class="user-header">
                        <div class="user-avatar">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2c5.52 0 10 4.48 10 10s-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2zm0 4c-1.93 0-3.5 1.57-3.5 3.5S10.07 13 12 13s3.5-1.57 3.5-3.5S13.93 6 12 6zm0 14c-2.03 0-4.43-.82-6.14-2.88a9.947 9.947 0 0 1 12.28 0C16.43 19.18 14.03 20 12 20z"/>
                            </svg>
                        </div>
                        <div class="user-info">
                            <h3 id="user-display-name">Usuario</h3>
                            <p id="user-display-email">email@ejemplo.com</p>
                        </div>
                    </div>
                    
                    <div class="menu-options">
                        <button id="btn-my-services" class="menu-option">
                            <span class="icon">ÔøΩ</span>
                            <span>Mis Servicios</span>
                        </button>
                        <button id="btn-my-reviews" class="menu-option">
                            <span class="icon">‚≠ê</span>
                            <span>Mis Valoraciones</span>
                        </button>
                        <button id="btn-edit-profile" class="menu-option">
                            <span class="icon">ÔøΩ</span>
                            <span>Editar Perfil</span>
                        </button>
                        <button id="btn-logout" class="menu-option logout-option">
                            <span class="icon">üö™</span>
                            <span>Cerrar Sesi√≥n</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <div id="notification-container"></div>

    <!-- control-staging-area eliminado para evitar IDs duplicados -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>